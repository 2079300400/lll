"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[293],{8853:function(t,e,n){n.r(e),n.d(e,{default:function(){return _}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-profile"},[e("van-nav-bar",{attrs:{title:"个人资料","left-arrow":""},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"container"},[e("input",{attrs:{type:"file",hidden:"",accept:"image/*",id:"file"},on:{change:t.change}}),e("van-cell",{attrs:{title:"头像",center:""}},[e("label",{attrs:{for:"file"}},[e("van-image",{attrs:{width:"50",height:"50",round:"",fit:"cover",src:t.userInfo.avatar}})],1)]),e("van-cell",{attrs:{title:"昵称","is-link":"",value:t.userInfo.nickname},on:{click:t.showDialog}}),e("van-cell",{attrs:{title:"性别","is-link":"",value:t.userInfo.sex||"请选择性别"},on:{click:function(e){t.sexPickerShow=!0}}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.sexPickerShow,callback:function(e){t.sexPickerShow=e},expression:"sexPickerShow"}},[e("van-picker",{attrs:{"show-toolbar":"",columns:["男","女"]},on:{confirm:t.sexPickerConfirm,cancel:function(e){t.sexPickerShow=!1}}})],1),e("van-cell",{attrs:{title:"生日","is-link":"",value:t.userInfo.birthday||"请选择生日"},on:{click:function(e){t.datePickerShow=!0}}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[e("van-datetime-picker",{attrs:{value:t.userInfo.birthday?new Date(t.userInfo.birthday):new Date("2000/01/01"),type:"date",title:"选择年月日","min-date":t.minDate,"max-date":t.maxDate},on:{confirm:t.datePickerConfirm,cancel:function(e){t.datePickerShow=!1}}})],1),e("div",{staticStyle:{margin:"30px 50px"}},[e("van-button",{attrs:{round:"",block:"",color:"#4badef",type:"primary",size:"normal",square:!0,"native-type":"submit"},on:{click:t.save}},[t._v("保存")])],1)],1),e("van-dialog",{attrs:{title:"修改昵称","show-cancel-button":""},model:{value:t.nickDialogShow,callback:function(e){t.nickDialogShow=e},expression:"nickDialogShow"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.userInfo.nickname,expression:"userInfo.nickname"}],attrs:{type:"text"},domProps:{value:t.userInfo.nickname},on:{input:function(e){e.target.composing||t.$set(t.userInfo,"nickname",e.target.value)}}})])],1)},o=[],a=(n(8618),n(5705)),r=n(3822),s=(n(9293),n(7722)),u=(n(3891),n(6811)),l={components:{[u.Z.name]:u.Z,[s.Z.name]:s.Z},data(){return{sexPickerShow:!1}},methods:{sexPickerConfirm(t){console.log(t),this.sexPickerShow=!1,this.userInfo.sex=t}}},c=(n(5623),n(6121),n(5941),n(9299)),h=n(855),f=n(8701),m=n(4535),d=n(668);function p(t,e){if(t<0)return[];var n=-1,i=Array(t);while(++n<t)i[n]=e(n);return i}function g(t){if(!t)return 0;while((0,d.i)(parseInt(t,10))){if(!(t.length>1))return 0;t=t.slice(1)}return parseInt(t,10)}function v(t,e){return 32-new Date(t,e-1,32).getDate()}var y=n(7111),k=(0,c.Z)({},y.i,{value:null,filter:Function,columnsOrder:Array,showToolbar:{type:Boolean,default:!0},formatter:{type:Function,default:function(t,e){return e}}}),x={data:function(){return{innerValue:this.formatValue(this.value)}},computed:{originColumns:function(){var t=this;return this.ranges.map((function(e){var n=e.type,i=e.range,o=p(i[1]-i[0]+1,(function(t){var e=(0,f.B)(i[0]+t);return e}));return t.filter&&(o=t.filter(n,o)),{type:n,values:o}}))},columns:function(){var t=this;return this.originColumns.map((function(e){return{values:e.values.map((function(n){return t.formatter(e.type,n)}))}}))}},watch:{columns:"updateColumnValue",innerValue:function(t,e){e?this.$emit("input",t):this.$emit("input",null)}},mounted:function(){var t=this;this.updateColumnValue(),this.$nextTick((function(){t.updateInnerValue()}))},methods:{getPicker:function(){return this.$refs.picker},getProxiedPicker:function(){var t=this,e=this.$refs.picker;if(e){var n=function(n){return function(){e[n].apply(e,arguments),t.updateInnerValue()}};return(0,c.Z)({},e,{setValues:n("setValues"),setIndexes:n("setIndexes"),setColumnIndex:n("setColumnIndex"),setColumnValue:n("setColumnValue")})}},onConfirm:function(){this.$emit("input",this.innerValue),this.$emit("confirm",this.innerValue)},onCancel:function(){this.$emit("cancel")}},render:function(){var t=this,e=arguments[0],n={};return Object.keys(y.i).forEach((function(e){n[e]=t[e]})),e(s.Z,{ref:"picker",attrs:{columns:this.columns,readonly:this.readonly},scopedSlots:this.$scopedSlots,on:{change:this.onChange,confirm:this.onConfirm,cancel:this.onCancel},props:(0,c.Z)({},n)})}},w=(0,h.d)("time-picker"),C=w[0],b=C({mixins:[x],props:(0,c.Z)({},k,{minHour:{type:[Number,String],default:0},maxHour:{type:[Number,String],default:23},minMinute:{type:[Number,String],default:0},maxMinute:{type:[Number,String],default:59}}),computed:{ranges:function(){return[{type:"hour",range:[+this.minHour,+this.maxHour]},{type:"minute",range:[+this.minMinute,+this.maxMinute]}]}},watch:{filter:"updateInnerValue",minHour:function(){var t=this;this.$nextTick((function(){t.updateInnerValue()}))},maxHour:function(t){var e=this.innerValue.split(":"),n=e[0],i=e[1];n>=t?(this.innerValue=this.formatValue(t+":"+i),this.updateColumnValue()):this.updateInnerValue()},minMinute:"updateInnerValue",maxMinute:function(t){var e=this.innerValue.split(":"),n=e[0],i=e[1];i>=t?(this.innerValue=this.formatValue(n+":"+t),this.updateColumnValue()):this.updateInnerValue()},value:function(t){t=this.formatValue(t),t!==this.innerValue&&(this.innerValue=t,this.updateColumnValue())}},methods:{formatValue:function(t){t||(t=(0,f.B)(this.minHour)+":"+(0,f.B)(this.minMinute));var e=t.split(":"),n=e[0],i=e[1];return n=(0,f.B)((0,m.w6)(n,this.minHour,this.maxHour)),i=(0,f.B)((0,m.w6)(i,this.minMinute,this.maxMinute)),n+":"+i},updateInnerValue:function(){var t=this.getPicker().getIndexes(),e=t[0],n=t[1],i=this.originColumns,o=i[0],a=i[1],r=o.values[e]||o.values[0],s=a.values[n]||a.values[0];this.innerValue=this.formatValue(r+":"+s),this.updateColumnValue()},onChange:function(t){var e=this;this.updateInnerValue(),this.$nextTick((function(){e.$nextTick((function(){e.updateInnerValue(),e.$emit("change",t)}))}))},updateColumnValue:function(){var t=this,e=this.formatter,n=this.innerValue.split(":"),i=[e("hour",n[0]),e("minute",n[1])];this.$nextTick((function(){t.getPicker().setValues(i)}))}}});function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},V(t,e)}function B(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function D(t,e,n){return D=B()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var o=Function.bind.apply(t,i),a=new o;return n&&V(a,n.prototype),a},D.apply(null,arguments)}function S(t){return"[object Date]"===Object.prototype.toString.call(t)&&!(0,d.i)(t.getTime())}var $=(new Date).getFullYear(),I=(0,h.d)("date-picker"),P=I[0],O=P({mixins:[x],props:(0,c.Z)({},k,{type:{type:String,default:"datetime"},minDate:{type:Date,default:function(){return new Date($-10,0,1)},validator:S},maxDate:{type:Date,default:function(){return new Date($+10,11,31)},validator:S}}),watch:{filter:"updateInnerValue",minDate:function(){var t=this;this.$nextTick((function(){t.updateInnerValue()}))},maxDate:function(t){this.innerValue.valueOf()>=t.valueOf()?this.innerValue=t:this.updateInnerValue()},value:function(t){t=this.formatValue(t),t&&t.valueOf()!==this.innerValue.valueOf()&&(this.innerValue=t)}},computed:{ranges:function(){var t=this.getBoundary("max",this.innerValue?this.innerValue:this.minDate),e=t.maxYear,n=t.maxDate,i=t.maxMonth,o=t.maxHour,a=t.maxMinute,r=this.getBoundary("min",this.innerValue?this.innerValue:this.minDate),s=r.minYear,u=r.minDate,l=r.minMonth,c=r.minHour,h=r.minMinute,f=[{type:"year",range:[s,e]},{type:"month",range:[l,i]},{type:"day",range:[u,n]},{type:"hour",range:[c,o]},{type:"minute",range:[h,a]}];switch(this.type){case"date":f=f.slice(0,3);break;case"year-month":f=f.slice(0,2);break;case"month-day":f=f.slice(1,3);break;case"datehour":f=f.slice(0,4);break}if(this.columnsOrder){var m=this.columnsOrder.concat(f.map((function(t){return t.type})));f.sort((function(t,e){return m.indexOf(t.type)-m.indexOf(e.type)}))}return f}},methods:{formatValue:function(t){var e=this;if(!S(t))return null;var n=new Date(this.minDate),i=new Date(this.maxDate),o={year:"getFullYear",month:"getMonth",day:"getDate",hour:"getHours",minute:"getMinutes"};if(this.originColumns){var a=this.originColumns.map((function(t,a){var r=t.type,s=t.values,u=e.ranges[a].range,l=n[o[r]](),c=i[o[r]](),h="month"===r?+s[0]-1:+s[0],f="month"===r?+s[s.length-1]-1:+s[s.length-1];return{type:r,values:[l<u[0]?Math.max(l,h):h||l,c>u[1]?Math.min(c,f):f||c]}}));if("month-day"===this.type){var r=(this.innerValue||this.minDate).getFullYear();a.unshift({type:"year",values:[r,r]})}var s=Object.keys(o).map((function(t){var e;return null==(e=a.filter((function(e){return e.type===t}))[0])?void 0:e.values})).filter((function(t){return t}));n=D(Date,s.map((function(t){return g(t[0])}))),i=D(Date,s.map((function(t){return g(t[1])})))}return t=Math.max(t,n.getTime()),t=Math.min(t,i.getTime()),new Date(t)},getBoundary:function(t,e){var n,i=this[t+"Date"],o=i.getFullYear(),a=1,r=1,s=0,u=0;return"max"===t&&(a=12,r=v(e.getFullYear(),e.getMonth()+1),s=23,u=59),e.getFullYear()===o&&(a=i.getMonth()+1,e.getMonth()+1===a&&(r=i.getDate(),e.getDate()===r&&(s=i.getHours(),e.getHours()===s&&(u=i.getMinutes())))),n={},n[t+"Year"]=o,n[t+"Month"]=a,n[t+"Date"]=r,n[t+"Hour"]=s,n[t+"Minute"]=u,n},updateInnerValue:function(){var t,e,n,i=this,o=this.type,a=this.getPicker().getIndexes(),r=function(t){var e=0;i.originColumns.forEach((function(n,i){t===n.type&&(e=i)}));var n=i.originColumns[e].values;return g(n[a[e]])};"month-day"===o?(t=(this.innerValue||this.minDate).getFullYear(),e=r("month"),n=r("day")):(t=r("year"),e=r("month"),n="year-month"===o?1:r("day"));var s=v(t,e);n=n>s?s:n;var u=0,l=0;"datehour"===o&&(u=r("hour")),"datetime"===o&&(u=r("hour"),l=r("minute"));var c=new Date(t,e-1,n,u,l);this.innerValue=this.formatValue(c)},onChange:function(t){var e=this;this.updateInnerValue(),this.$nextTick((function(){e.$nextTick((function(){e.updateInnerValue(),e.$emit("change",t)}))}))},updateColumnValue:function(){var t=this,e=this.innerValue?this.innerValue:this.minDate,n=this.formatter,i=this.originColumns.map((function(t){switch(t.type){case"year":return n("year",""+e.getFullYear());case"month":return n("month",(0,f.B)(e.getMonth()+1));case"day":return n("day",(0,f.B)(e.getDate()));case"hour":return n("hour",(0,f.B)(e.getHours()));case"minute":return n("minute",(0,f.B)(e.getMinutes()));default:return null}}));this.$nextTick((function(){t.getPicker().setValues(i)}))}}}),Z=(0,h.d)("datetime-picker"),M=Z[0],T=Z[1],H=M({props:(0,c.Z)({},b.props,O.props),methods:{getPicker:function(){return this.$refs.root.getProxiedPicker()}},render:function(){var t=arguments[0],e="time"===this.type?b:O;return t(e,{ref:"root",class:T(),scopedSlots:this.$scopedSlots,props:(0,c.Z)({},this.$props),on:(0,c.Z)({},this.$listeners)})}}),A=n(4493),F={components:{[u.Z.name]:u.Z,[H.name]:H},data(){return{datePickerShow:!1,minDate:new Date(1920,0,1),maxDate:new Date}},methods:{datePickerConfirm(t){console.log(t),this.datePickerShow=!1,this.userInfo.birthday=(0,A.t)(t)}}},N=n(2900),E={name:"userInfo",data(){return{userInfo:{},nickDialogShow:!1}},mixins:[l,F],components:{[a.Z.Component.name]:a.Z.Component},watch:{"$store.state.userInfo":{immediate:!0,handler(t,e){this.userInfo=JSON.parse(JSON.stringify(t))}}},methods:{...(0,r.nv)(["upload"]),save(){console.log(this.userInfo);let{nickname:t,avatar:e,_id:n,birthday:i,sex:o}=this.userInfo;console.log(t,e,n,i,o),(0,N.B_)({nickname:t,avatar:e,uid:n,birthday:i,sex:o}).then((t=>{console.log(t),this.$toast(t.msg),0==t.code&&(this.$store.dispatch("getuserInfo",localStorage.getItem("token")),setTimeout((t=>{this.$router.back()}),300))}))},showDialog(){this.nickDialogShow=!0},async change(t){let e=[...t.target.files].map((t=>({file:t}))),[n]=await this.upload(e);this.userInfo.avatar=n}}},Y=E,j=n(1001),R=(0,j.Z)(Y,i,o,!1,null,"e30413fa",null),_=R.exports},5705:function(t,e,n){n.d(e,{Z:function(){return Z}});var i,o=n(9299),a=n(6369),r=n(3915),s=n.n(r),u=n(3370),l=n(855),c=n(408),h=n(1047),f=n(7846),m=n(4398),d=n(2115),p=(0,l.d)("goods-action"),g=p[0],v=p[1],y=g({mixins:[(0,d.G)("vanGoodsAction")],props:{safeAreaInsetBottom:{type:Boolean,default:!0}},render:function(){var t=arguments[0];return t("div",{class:v({unfit:!this.safeAreaInsetBottom})},[this.slots()])}}),k=n(2250),x=(0,l.d)("goods-action-button"),w=x[0],C=x[1],b=w({mixins:[(0,d.j)("vanGoodsAction")],props:(0,o.Z)({},k.g2,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean}),computed:{isFirst:function(){var t=this.parent&&this.parent.children[this.index-1];return!t||t.$options.name!==this.$options.name},isLast:function(){var t=this.parent&&this.parent.children[this.index+1];return!t||t.$options.name!==this.$options.name}},methods:{onClick:function(t){this.$emit("click",t),(0,k.BC)(this.$router,this)}},render:function(){var t=arguments[0];return t(m.Z,{class:C([{first:this.isFirst,last:this.isLast},this.type]),attrs:{size:"large",type:this.type,icon:this.icon,color:this.color,loading:this.loading,disabled:this.disabled},on:{click:this.onClick}},[this.slots()||this.text])}}),V=(0,l.d)("dialog"),B=V[0],D=V[1],S=V[2],$=B({mixins:[(0,f.e)()],props:{title:String,theme:String,width:[Number,String],message:String,className:null,callback:Function,beforeClose:Function,messageAlign:String,cancelButtonText:String,cancelButtonColor:String,confirmButtonText:String,confirmButtonColor:String,showCancelButton:Boolean,overlay:{type:Boolean,default:!0},allowHtml:{type:Boolean,default:!0},transition:{type:String,default:"van-dialog-bounce"},showConfirmButton:{type:Boolean,default:!0},closeOnPopstate:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!1}},data:function(){return{loading:{confirm:!1,cancel:!1}}},methods:{onClickOverlay:function(){this.handleAction("overlay")},handleAction:function(t){var e=this;this.$emit(t),this.value&&(this.beforeClose?(this.loading[t]=!0,this.beforeClose(t,(function(n){!1!==n&&e.loading[t]&&e.onClose(t),e.loading.confirm=!1,e.loading.cancel=!1}))):this.onClose(t))},onClose:function(t){this.close(),this.callback&&this.callback(t)},onOpened:function(){var t=this;this.$emit("opened"),this.$nextTick((function(){var e;null==(e=t.$refs.dialog)||e.focus()}))},onClosed:function(){this.$emit("closed")},onKeydown:function(t){var e=this;if("Escape"===t.key||"Enter"===t.key){if(t.target!==this.$refs.dialog)return;var n={Enter:this.showConfirmButton?function(){return e.handleAction("confirm")}:u.ZT,Escape:this.showCancelButton?function(){return e.handleAction("cancel")}:u.ZT};n[t.key](),this.$emit("keydown",t)}},genRoundButtons:function(){var t=this,e=this.$createElement;return e(y,{class:D("footer")},[this.showCancelButton&&e(b,{attrs:{size:"large",type:"warning",text:this.cancelButtonText||S("cancel"),color:this.cancelButtonColor,loading:this.loading.cancel},class:D("cancel"),on:{click:function(){t.handleAction("cancel")}}}),this.showConfirmButton&&e(b,{attrs:{size:"large",type:"danger",text:this.confirmButtonText||S("confirm"),color:this.confirmButtonColor,loading:this.loading.confirm},class:D("confirm"),on:{click:function(){t.handleAction("confirm")}}})])},genButtons:function(){var t,e=this,n=this.$createElement,i=this.showCancelButton&&this.showConfirmButton;return n("div",{class:[h.k7,D("footer")]},[this.showCancelButton&&n(m.Z,{attrs:{size:"large",loading:this.loading.cancel,text:this.cancelButtonText||S("cancel"),nativeType:"button"},class:D("cancel"),style:{color:this.cancelButtonColor},on:{click:function(){e.handleAction("cancel")}}}),this.showConfirmButton&&n(m.Z,{attrs:{size:"large",loading:this.loading.confirm,text:this.confirmButtonText||S("confirm"),nativeType:"button"},class:[D("confirm"),(t={},t[h.a8]=i,t)],style:{color:this.confirmButtonColor},on:{click:function(){e.handleAction("confirm")}}})])},genContent:function(t,e){var n=this.$createElement;if(e)return n("div",{class:D("content")},[e]);var i=this.message,o=this.messageAlign;if(i){var a,r,u={class:D("message",(a={"has-title":t},a[o]=o,a)),domProps:(r={},r[this.allowHtml?"innerHTML":"textContent"]=i,r)};return n("div",{class:D("content",{isolated:!t})},[n("div",s()([{},u]))])}}},render:function(){var t=arguments[0];if(this.shouldRender){var e=this.message,n=this.slots(),i=this.slots("title")||this.title,o=i&&t("div",{class:D("header",{isolated:!e&&!n})},[i]);return t("transition",{attrs:{name:this.transition},on:{afterEnter:this.onOpened,afterLeave:this.onClosed}},[t("div",{directives:[{name:"show",value:this.value}],attrs:{role:"dialog","aria-labelledby":this.title||e,tabIndex:0},class:[D([this.theme]),this.className],style:{width:(0,c.N)(this.width)},ref:"dialog",on:{keydown:this.onKeydown}},[o,this.genContent(i,n),"round-button"===this.theme?this.genRoundButtons():this.genButtons()])])}}});function I(t){return document.body.contains(t)}function P(){i&&i.$destroy(),i=new(a.ZP.extend($))({el:document.createElement("div"),propsData:{lazyRender:!1}}),i.$on("input",(function(t){i.value=t}))}function O(t){return u.sk?Promise.resolve():new Promise((function(e,n){i&&I(i.$el)||P(),(0,o.Z)(i,O.currentOptions,t,{resolve:e,reject:n})}))}O.defaultOptions={value:!0,title:"",width:"",theme:null,message:"",overlay:!0,className:"",allowHtml:!0,lockScroll:!0,transition:"van-dialog-bounce",beforeClose:null,overlayClass:"",overlayStyle:null,messageAlign:"",getContainer:"body",cancelButtonText:"",cancelButtonColor:null,confirmButtonText:"",confirmButtonColor:null,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,callback:function(t){i["confirm"===t?"resolve":"reject"](t)}},O.alert=O,O.confirm=function(t){return O((0,o.Z)({showCancelButton:!0},t))},O.close=function(){i&&(i.value=!1)},O.setDefaultOptions=function(t){(0,o.Z)(O.currentOptions,t)},O.resetDefaultOptions=function(){O.currentOptions=(0,o.Z)({},O.defaultOptions)},O.resetDefaultOptions(),O.install=function(){a.ZP.use($)},O.Component=$,a.ZP.prototype.$dialog=O;var Z=O},8618:function(t,e,n){n(5623),n(4966),n(4933),n(3671),n(3979),n(6121),n(2195)},4535:function(t,e,n){function i(t,e,n){return Math.min(Math.max(t,e),n)}function o(t,e,n){var i=t.indexOf(e),o="";return-1===i?t:"-"===e&&0!==i?t.slice(0,i):("."===e&&t.match(/^(\.|-\.)/)&&(o=i?"-0":"0"),o+t.slice(0,i+1)+t.slice(i).replace(n,""))}function a(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!0),t=e?o(t,".",/\./g):t.split(".")[0],t=n?o(t,"-",/-/g):t.replace(/-/,"");var i=e?/[^-0-9.]/g:/[^-0-9]/g;return t.replace(i,"")}n.d(e,{uf:function(){return a},w6:function(){return i}})}}]);
//# sourceMappingURL=293.523271bb.js.map